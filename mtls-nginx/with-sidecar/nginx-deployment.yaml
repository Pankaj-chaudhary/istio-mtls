apiVersion: v1
kind: Namespace
metadata:
  creationTimestamp: null
  name: mesh-external
spec: {}
status: {}
---
apiVersion: v1
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVWVENDQXoyZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREF0TVJVd0V3WURWUVFLREF4bGVHRnQKY0d4bElFbHVZeTR4RkRBU0JnTlZCQU1NQzJWNFlXMXdiR1V1WTI5dE1CNFhEVEkwTVRFeU1EQXlNamd3T0ZvWApEVEkxTVRFeU1EQXlNamd3T0Zvd0RURUxNQWtHQTFVRUJoTUNWVk13Z2dJaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUNEd0F3Z2dJS0FvSUNBUUNlbDhHaDY0YXhJN3VUTUM0aDl4anRLUThvdFRiN0tOYkM4TmNpSmxGRGdEblMKQ2ZpTkVWZjliQzRtSVBMRUdlSEVNQmFCWWJBeS9UZGNCcjcvUzArbzB0SC9hcDQyeTRXVFlabXQ0YnFwVzRtZApOQ3VVWHAzZllVaEhQM1JqbU1pQ2RNQjhKZjRlRE5iVmMrMWY0R1JKck9Pcjk3Rk5DczdSektrTWsxaDBhYXpRCm9PbExlRjJROE5DQmo1UERiVG9GRUZQSE5BSlNpa2djMkM0bVBvQjBvSmRUVjJPU2NuS0w0ekdEb05HMDRHdHkKYWxJMUxTdGVMZnA4OGMvZDlxMm9Vd2U3TjVhMzM0UDZPdklJZGNqejN0U3BjVmc1MmVoa2V2RkQxUnhLQjgxRwpoNDArZzdONUVMcEdxM3RvUzFCbmNWTCs5bGlVU254dUdVWUM2eitvM0hMK1hGekhqYlMxWXZIelN4SVI4cndOCjI5c2J1ZVVWakt6ZndEcDJyZ1poZXFBRGR4SDhzeVIrdzJBTUY2SHZGb21kYVRXVDRtZU5SdzAwVFVqYmZXa2wKYW9taEthdXVkYTA5M2Y2UXVlUHRGbXZGVHppQlZmUmdmaVhYRFJoY3dxT0VPNG5wQnVuRW5kVnk0alk0UUkyYQpYZkIrem5wTDl0TTNMZDQzR296bHRWa1BRQ01TYjYzV2FHWGJ5ZEZVbGhSYVoyNDFncVZ4Yzl3eWJ6UU1DTFFXCmhXZkRtdkFPdXA4d25aeHNsQnQ4R2tjSzJJd1JhdzlWcWNSNU92d045azZYTkx0VGs1ekRRU0pYckFENTRSOUIKQjlFSXM3TFFJblIxZnlvajJ3MjkrSFVMN2ZlSmtwSkNuSUpvWjlncERwUW1Sc1NVVHFJV1JaM0g1N04xOFFJRApBUUFCbzRHZk1JR2NNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJCkt3WUJCUVVIQXdJd0RBWURWUjBUQVFIL0JBSXdBREJkQmdOVkhSRUJBZjhFVXpCUmdpaHRlUzF1WjJsdWVDNXQKWlhOb0xXVjRkR1Z5Ym1Gc0xuTjJZeTVqYkhWemRHVnlMbXh2WTJGc2dnbHNiMk5oYkdodmMzU0NHbXQxWW1WeQpibVYwWlhNdVpHOWphMlZ5TG1sdWRHVnlibUZzTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFBZmZlSFVmVitVCkJvSUtiRU1UN2tCOEZXMDlJR0IxOXJXVnZ6YkRiR083d3FDajUvUG85Ni9aUk5HZi9hTU5tVkhFMTFMaHc2NGUKY0Fkc1dLOG15RURPRVRnQ291VWhKTUxCYVBTK2tjSVZpWXVjZVBvR1VEWHhzYmNWMzYweGtXTTFLbmc4QTlubApyU2VVZlo0dEhzSmZ5Rlo2bVlLQmNVY1NTTk1yRGFnTjNKWVBoUk85YXFjYVlvWVJQRlRQcFozL1RrclZCajZqCjZHZ0VZeHhncHJzUUErK1E1SXJRaW1tVTJYbXZmMWRoNnFDdGVMRERxMnU4dnpHOU95dmRVbExXWmw3bTBLNC8Kc3lpYWVRS081eEhFMTE4dWFzVU9vYVAyUGN4d3lGQy9KRHZ5RjBHWS9OZS9EUXliRTZIaitIalphb2g0YUdFcQpCSlBVN2hGRlFJanQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRUUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1Nzd2dna25BZ0VBQW9JQ0FRQ2VsOEdoNjRheEk3dVQKTUM0aDl4anRLUThvdFRiN0tOYkM4TmNpSmxGRGdEblNDZmlORVZmOWJDNG1JUExFR2VIRU1CYUJZYkF5L1RkYwpCcjcvUzArbzB0SC9hcDQyeTRXVFlabXQ0YnFwVzRtZE5DdVVYcDNmWVVoSFAzUmptTWlDZE1COEpmNGVETmJWCmMrMWY0R1JKck9Pcjk3Rk5DczdSektrTWsxaDBhYXpRb09sTGVGMlE4TkNCajVQRGJUb0ZFRlBITkFKU2lrZ2MKMkM0bVBvQjBvSmRUVjJPU2NuS0w0ekdEb05HMDRHdHlhbEkxTFN0ZUxmcDg4Yy9kOXEyb1V3ZTdONWEzMzRQNgpPdklJZGNqejN0U3BjVmc1MmVoa2V2RkQxUnhLQjgxR2g0MCtnN041RUxwR3EzdG9TMUJuY1ZMKzlsaVVTbnh1CkdVWUM2eitvM0hMK1hGekhqYlMxWXZIelN4SVI4cndOMjlzYnVlVVZqS3pmd0RwMnJnWmhlcUFEZHhIOHN5UisKdzJBTUY2SHZGb21kYVRXVDRtZU5SdzAwVFVqYmZXa2xhb21oS2F1dWRhMDkzZjZRdWVQdEZtdkZUemlCVmZSZwpmaVhYRFJoY3dxT0VPNG5wQnVuRW5kVnk0alk0UUkyYVhmQit6bnBMOXRNM0xkNDNHb3psdFZrUFFDTVNiNjNXCmFHWGJ5ZEZVbGhSYVoyNDFncVZ4Yzl3eWJ6UU1DTFFXaFdmRG12QU91cDh3blp4c2xCdDhHa2NLMkl3UmF3OVYKcWNSNU92d045azZYTkx0VGs1ekRRU0pYckFENTRSOUJCOUVJczdMUUluUjFmeW9qMncyOStIVUw3ZmVKa3BKQwpuSUpvWjlncERwUW1Sc1NVVHFJV1JaM0g1N04xOFFJREFRQUJBb0lDQURsRVVVNVh6d1pPQWVDdmFDa3BvZDJaCmt2aS9Id0JvaWN4UXpVNXVpYStYTU1uUWdlam1sMkJTWFFPMXFCUDV5SlZnUy9BaVIwN1NNdGhQTTA3YWNnUmoKUkNNMzY3T2JvRHRNNWdKczNVdGtXM2ZocTg3aXI1MUc4cU9QblVhTmwvSExtT243aWh4dHhISEZiN1RNUVVwOQpYS1R2UngycnhtenB1eTFvVTJ1TjhUSlF1STFoQkdCZkpOdHo3Z2FHZllud2tHQUJQc2x4VjRMYTZTYzBNSXhzCnBOZ2FXVUU3aEhOUThjTTNJaUp2V3owd2VVanNhNW1SZnI3NVRuYzNLUlA4RDNHaUxCRnZhNmZDK3p6azAxQ0UKYVVSYVFtSjVkam82VHI2UXlLdE96K2drOEhMZmVjSkFzUkx0dngwMC9PNnRkQ3ZPNXNOOWRoc0hrMGxnaTFhcgo0d25lVFJaMk51amw4VFBVN3hpdGlHMEpBSUFWbzhEeXZhNTl6RXZoN3U1QUZ4QlA4UlEyUXRGd3NTelE5eFRnCnBaNEVoU2hhL3JzUVlhbWdKS1RPcmhCcXJ3c2Q4cWQ3eTFBNW5TaVcvb2J5R2o0UjMxTEI3SHVKdklWaUErbUUKS21ZTG9EcHZTdnBDN2NlMFpkNkFDQ3g0dVFyM1g0am1KSTdmM29ubGd0THZRdE9TYjJjcnY4RWxQRXpWaVRjMgozUjFYbEtSOHlGckhoWHNJVGpSWHFRcm9IYS9sbmZhS1RQQ2FBZkptWERKM0E3eGs3OFNqeWcxS1F4ajlaKzRyClQ5M0QxTWgyOG1UUS9Pclg5WVZHRk9mY1FvYVhTUXFPU1c0clo5U0NBSUp2SWJzbWpPWVBvSUlucHlNdDdMSDEKMGU1U1BBVTI0LzVJQTBXaUthbnhBb0lCQVFETWlRWjVZUFFUSXVGV2RDemNna0xHeEhERWtYV2RsSGdsTCtScgowYmxIc3lCYnh6RWJVOG5HOHZrRDdHSHFUcm9EUUJoRnhhTFZuTy9FQmE5dWdzVVpFVlY4ZVRwM0JXSW9RNjJ1CnVkOGRPWmNjK2o3RmVLUll2R3BGR0VTWkJDNDNjeTRPQmlqaTBTQWZoNXZ6N3o4ZXRra0JuVWFvcU9jNnNTaHQKSVcrYWFVVEkxUmFjZU5UMkJOTWlYZWtHN2s5TktsRHlwRzdUUWpQSHFqZFFLQno1MlpOS3E5QXhaaGZRV29kRAp3ejd3LzkrL0ViNzArSTBMVEtuMWkrM08rSi9oblJ2N2JKN2Q0M29VY0FTcFBOQjAvVkNHTlFBRWN0ZUZVVElLCkJqaXR4OEtQdzc5NDg1b3ZISWgrMkdSS3dPU0x2ZGNJNENnWUQwT0JzdEMrbmg4ZEFvSUJBUURHZjJKdjNOTkMKV0tKVkdTOGljdzlqc0JwTkFKNHVBNnhjRnlSS2dLRHlYMmxVVzhsc1JLT2cwTTRSdVd3Z0cyRUtrQk9WZkdwcwpLTGV0dFVBb2xHeVNvaGlZUy9HWXcvSFJrQ2tTUzJOQ0MyZEQyR1pQbnpWdWdtZHFvVFhUcVJlT0tpTEZvVElSCkptc1RBTkpmNWxjUUl0ZGUrRWRTQmpsWlJycTBzV0ZJcmhjQ01scVJuRSt1QWZleTRtWkFuclcxa0RHck00SFoKQkFkUXNsWmNHVlIwRk1KMCt4cXRWYkVkMzhRb1g0MEdJeGsySWtaSitYZWl1YUJVeTBpUytyOTk4QjFpUjJFUApUbTU0UXNZN0o2Q3hBYmJiYjJtbE5Fb3ZyMDNWWDg1aHpjSzZjSnNoZzJkaUZ6Y256dFNVaE8xeDZKOVA5RDU4CjVadm9xNWF2RVZYbEFvSUJBSDhmeDJ0WGpEdjhtT3VnQjJZQ2ZEaUlUY0tPMmZoWUdCaWMzSzc2eWRxN2hhZ2wKZE9zVU43dzB0ZnJ2UjZoV3lCeFBFUWNFb0lGK0tqTytpTnY1NFVFRVdncWtXbWN4YkdHME50WDdacVlHYmxxdgpXcVpucGxZVXZVUTJvaVFzeWdEaTBNUWNwZnJibWNpZkE1b29vQ1daakdTNWVQcEpDSGFkTjVBa2tQWDY2YXFkCmJwRlFOS1M0T1BZS1FsUnhkODV4TjZDbi9NM0hQdUdoZFFHWC9QSjVmYWVTaERLL3pwdE1PUGd2K1FYWE14elIKamNzNlZJZXFYWlJsSlNoWHRSK0lBNlZRVEttQ3doVER6dEhWSDRjbkRvNXJrSmd6UEtyNjNVd0hzK0NtNE5GMApDNlRFVzVkZWQ2UEhJUWFwUHlOdm1hQkZtZ1hpTHNZRSt1TU82aTBDZ2dFQUtieVhJaFk0aFhiRmkwY2tWZ1lECmNsNlE2U2Y4R29qRE1RbmNvNTJ3T2NZK0MzTFJRMmFiVVRFV1l6dXR0SUtOUVA5U1h0Z3VPRmZIWjByNUZvOCsKMVFZb1RiMktLeWpvSzd3NEpwU2Jaa09uanVodGVzaHJIN1Zqc1ZQOFVXajRmdmYxSDhEcEdob040WTBHcnd0cgp1d1RZYkN1Z00yc0RtL1gzUkE4WCtZUkJha0RVTWxHL24wTGlwa1pjWWJIOVd4UGFuYmpTMEtLOE53ZUlpUXo2CmFQNEVkVHhuTzVNTkRzOENHOHNiaC9MUlZrU1dxdTg5YklYRFpKRHB6WjNUcmROVEdsc1AyWHdRVmxFVUJWUXIKd1l3dXVxME9kYUl0QnlIQkorQmhNTWRtN25URzZhRUxsK0J4eEhrRTBjV3hkNFlHR1hXdHZlMDVmdzYxUEZKVQowUUtDQVFCbVkwVElzOVl5MERjWEw3RHd0WGZkSnVNNW9Ed0QzVzcwaityZ1BtN0ZhRXdRUEFNZU9RcnZoU1ZWCitxb2J4RndLVmp5L3cvUTlnMlV4NEdMc2hCaFBWWFo2eWxUaDFOWjVOWk1HWkhhejBOaEJkVXlGb3BwY2RKS0MKdGViT0tHbDUrY0RkUkNxOGdJM0ZvQVh1RFJrL3VjV0RGNVJqejh6Y21BTlR5bVlFaUtHSWc1OE9icUoxUzNKcwo4c0ZtSXE3UUR3WFQrcWdJU0Jmem00Wk43bXB6Mm9ETG5DMmZoRnRUVFZjVmtRa0x3RU9VaXNjdG93MkRta2duCklzM2FCVi91enJramZVRVZXVE9vOEFqbEF3T1FmWnRwUmlyNFRvOHc4MGJVMlBReVVEZVRJdVk0SFdLT1QzVk0KdzBWdm1DcGlmSjFxMmp0RjhrZzZyVWRDZHFCawotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==
kind: Secret
metadata:
  creationTimestamp: null
  name: nginx-server-certs
  namespace: mesh-external
---
apiVersion: v1
data:
  example.com.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMxakNDQWI0Q0NRQ3M0aG9la29tOGl6QU5CZ2txaGtpRzl3MEJBUXNGQURBdE1SVXdFd1lEVlFRS0RBeGwKZUdGdGNHeGxJRWx1WXk0eEZEQVNCZ05WQkFNTUMyVjRZVzF3YkdVdVkyOXRNQjRYRFRJME1URXlNREF5TWpjMApNbG9YRFRJMU1URXlNREF5TWpjME1sb3dMVEVWTUJNR0ExVUVDZ3dNWlhoaGJYQnNaU0JKYm1NdU1SUXdFZ1lEClZRUUREQXRsZUdGdGNHeGxMbU52YlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUIKQUxhQWpzbGxBWmY4aVBiR1lXNkJXajh4enQwZitoSlgrRFNOMWcyMG1GamJ2dW1Wc24zMjFNRC9wRDhtZEJVagpzeFhlTkZ0Ky9NLzgydTZFWUJHUEdoMklna2JWNjluT2tWd0dDUzFIQ1ZuOWh0V3NjMHo3YzB2bm96UDR0K0U3CnIzODBTUFBVQlREWkNJc0NjaGIzQVBwY3h6QXIrbXp0cXJHNEYyODVIUWhJN0ZNNW56WFdBWUdWVzB5Z3ErUTAKRFQ5WG9vZUZFYlhLd2JNQTVrZHkwSzVDRlZiM3NKTm9BQWswb3YrNHdqRVRJV25CTnJNaksyNVJqa3haR1djWQpVU1ppczVXWTYzUjBvbmg5Q0pkOEtYYU4zU09TL3Ruc1VxRkl3WFhSVjArY1pTdUd4KzFMN0xSMmhFdmE3dzJpCmQwU09mNUF2Z0xkWHYrcytpU2l2UkNrQ0F3RUFBVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBVjVvRll2c3UKMVhhLzJ4RHUxTWxRcUpaWCtla3Y2M1JtZTBUL2NtMHFTMEZUTSs2TktwV2xNc0FhM3M2UllMWnF1RG9HS1RCZQo2YVh3OVV0eDZ5Rk1YLy9CZjVjNS9ROHhMUjNIblhlLzkzOWpidzk3SnFJLzhqKzVKbjZYQTBzSHdjbzl1ZmY4CjVCK3dLNFZjYU15bTlRcTRmZlQvamdVWXNHL0FDb2xUYTVRMXZzWDdnRnArSW11MCtzTFg2Q0pVSitVN3M1aGMKWitOZ2k1YkhjOVcxcTFUbGNNREkzZmY2cHY5STNCUy9uenNMcElpUnQ3YXhFL0F6QlU3YXBQNDJURHNRRFFlUQoxRUQ0b0ZkRTJaMFM3SzYvaGIwZzJGNlZuMkhjNjdLUXVOckpScFJkait0djBldUplZ2NMaFRTNFRadTYxT0F6Cko1djl0anRWQWh0ME93PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
kind: Secret
metadata:
  creationTimestamp: null
  name: nginx-ca-certs
  namespace: mesh-external
---
apiVersion: v1
data:
  nginx.conf: |
    events {
    }

    http {
      log_format main '$remote_addr - $remote_user [$time_local]  $status '
      '"$request" $body_bytes_sent "$http_referer" '
      '"$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      error_log  /var/log/nginx/error.log;

      server {
        listen 443 ssl;

        root /usr/share/nginx/html;
        index index.html;

        server_name my-nginx.mesh-external.svc.cluster.local;
        ssl_certificate /etc/nginx-server-certs/tls.crt;
        ssl_certificate_key /etc/nginx-server-certs/tls.key;
        ssl_client_certificate /etc/nginx-ca-certs/example.com.crt;
        ssl_verify_client on;
      }
    }
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: nginx-configmap
  namespace: mesh-external
---
apiVersion: v1
kind: Service
metadata:
  name: my-nginx
  namespace: mesh-external
  labels:
    run: my-nginx
spec:
  ports:
  - port: 443
    protocol: TCP
  selector:
    run: my-nginx
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-nginx
  namespace: mesh-external
spec:
  selector:
    matchLabels:
      run: my-nginx
  replicas: 1
  template:
    metadata:
      labels:
        run: my-nginx
    spec:
      containers:
      - name: my-nginx
        image: nginx
        ports:
        - containerPort: 443
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx
          readOnly: true
        - name: nginx-server-certs
          mountPath: /etc/nginx-server-certs
          readOnly: true
        - name: nginx-ca-certs
          mountPath: /etc/nginx-ca-certs
          readOnly: true
      volumes:
      - name: nginx-config
        configMap:
          name: nginx-configmap
      - name: nginx-server-certs
        secret:
          secretName: nginx-server-certs
      - name: nginx-ca-certs
        secret:
          secretName: nginx-ca-certs